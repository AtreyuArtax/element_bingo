<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chemistry Element Bingo</title>
  <!-- Google Fonts for Card Generator -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <!-- Tailwind CSS CDN (for the new modal styling) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* --- CSS Variables for Theming (Combined from both files) --- */
    :root {
      /* Element Bingo Caller colors */
      --alkali-color: #f8ab92;         /* Alkali Metals */
      --alkaline-earth-color: #fed091;  /* Alkaline Earth Metals */
      --transition-color: #f7f29a;      /* Transition Metals */
      --basic-metal-color: #aad69b;     /* Basic (Post-Transition) Metals */
      --metalloid-color: #aadee7;       /* Metalloids */
      --nonmetal-color: #a1acd7;        /* Nonmetals */
      --halogen-color: #b09cca;         /* Halogens */
      --noble-gas-color: #cda2ca;         /* Noble Gases */
      --lanthanide-color: #ea9cc4;      /* Lanthanides */
      --actinide-color: #e1aacd;         /* Actinides */

      --bg-color: #f0f0f0;
      --text-color: #333;

      /* Card Generator colors */
      --font-family-main: 'Poppins', Arial, sans-serif;
      --primary-color: #007bff;
      --secondary-color: #6c757d;
      --light-gray: #f8f9fa;
      --medium-gray: #dee2e6;
      --dark-gray: #343a40;
      --border-color: #ced4da;
      --border-radius: 0.375rem; /* 6px - Used for screen and now print */
      --spacing-unit: 1rem;
      --card-border-color: #adb5bd;
      --card-header-bg: #e9ecef;
      --free-cell-bg: #f8f9fa;
    }

    /* --- Global Styles (from ElementBingo.html) --- */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg-color);
      color: var(--text-color);
      overflow-x: hidden; /* Prevent horizontal scroll due to menu */
    }

    /* --- Hamburger Menu Styles --- */
    .menu-button {
      background: none;
      border: none;
      font-size: 30px;
      cursor: pointer;
      padding: 5px 10px;
      color: var(--text-color);
      z-index: 11; /* Still keep z-index for overlay */
    }

    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: flex-start;
      align-items: flex-start;
      z-index: 999;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .menu-overlay.open {
      visibility: visible;
      opacity: 1;
    }

    .menu-content {
      background: #fff;
      padding: 20px;
      width: 250px;
      height: 100%;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
      transform: translateX(-100%);
      transition: transform 0.3s ease-out;
      display: flex;
      flex-direction: column;
    }

    .menu-overlay.open .menu-content {
      transform: translateX(0);
    }

    .menu-content button {
      display: block;
      width: 100%;
      padding: 15px 10px;
      margin-bottom: 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 18px;
      text-align: left;
    }

    .menu-content button:hover {
      background-color: #45a049;
    }

    .menu-close {
      background: none;
      border: none;
      font-size: 30px;
      color: #333;
      cursor: pointer;
      align-self: flex-end;
      margin-bottom: 20px;
    }

    /* --- Element Bingo Caller Styles (from ElementBingo.html) --- */
    .bingo-caller-page {
      display: block; /* Initially visible */
    }

    .header {
      display: flex;
      justify-content: space-between; /* Distribute items with space between them */
      align-items: center; /* Vertically center items */
      background: #ffffff;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      position: relative; /* Keep relative for z-index if needed, but not for child positioning */
      top: 0;
      z-index: 10;
    }
    .header-buttons {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .header-buttons button,
    .header-buttons select {
      font-size: 18px;
      padding: 8px 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .header-buttons button:hover,
    .header-buttons select:hover {
      background-color: #45a049;
    }
    .current {
      font-size: 48px;
      font-weight: bold;
      color: var(--text-color);
      text-align: center; /* Center the text within this flex item */
      white-space: nowrap; /* Prevent text wrapping */
      flex-grow: 1; /* Allow it to grow and take available space */
      margin: 0 auto; /* This will center it within the available flex space */
    }

    /* Main layout: two columns */
    .main {
      display: flex;
      align-items: flex-start;
      margin: 20px;
      gap: 20px;
    }

    /* Table wrapper: shrink-to-fit table and legend */
    .table-wrapper {
      display: inline-block;
      vertical-align: top;
    }

    .table-container {
      overflow-x: auto;
    }

    table.periodic-table {
      border-collapse: collapse;
      margin: 0 auto;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    /* Family color classes */
    td.alkali         { background-color: var(--alkali-color); }
    td.alkaline-earth { background-color: var(--alkaline-earth-color); }
    td.transition     { background-color: var(--transition-color); }
    td.basic-metal    { background-color: var(--basic-metal-color); }
    td.metalloid      { background-color: var(--metalloid-color); }
    td.nonmetal       { background-color: var(--nonmetal-color); }
    td.halogen        { background-color: var(--halogen-color); }
    td.noble          { background-color: var(--noble-gas-color); }
    td.lanthanide     { background-color: var(--lanthanide-color); }
    td.actinide       { background-color: var(--actinide-color); }

    table.periodic-table td {
      width: 42px;
      height: 42px;
      text-align: center;
      vertical-align: middle;
      border: 1px solid transparent;
      position: relative;
      font-size: 12px;
      cursor: pointer;
      transition: transform 0.2s;
      box-sizing: border-box;
    }

    .table-container {
      overflow-x: hidden;
      overflow-y: hidden;
    }

    table.periodic-table td:hover {
      transform: scale(1.1);
    }
    table.periodic-table td.empty {
      border: none;
      cursor: default;
    }
    table.periodic-table td.label {
      background-color: #e0e0e0;
      text-align: left;
      padding-left: 4px;
      font-weight: bold;
      cursor: default;
    }
    table.periodic-table td span.symbol {
      display: block;
      font-size: 10px;
    }
    table.periodic-table td span.atomic {
      position: absolute;
      top: 2px;
      left: 2px;
      font-size: 10px;
      color: #555;
    }
    /* Called/current indicators: use a black border with white cell */
    table.periodic-table td.called,
    table.periodic-table td.current {
      border-color: black;
      background-color: white;
    }

    /* Legend styles using CSS Grid */
    .legend {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      width: 100%;
      box-sizing: border-box;
      margin: 20px auto 0;
    }
    .legend-item {
      display: flex;
      align-items: center;
      padding: 5px 10px;
      border-radius: 20px;
      background: #e0e0e0;
      font-size: 11px;
    }
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
    }
    .legend-color.alkali { background-color: var(--alkali-color); }
    .legend-color.alkaline-earth { background-color: var(--alkaline-earth-color); }
    .legend-color.transition { background-color: var(--transition-color); }
    .legend-color.basic-metal { background-color: var(--basic-metal-color); }
    .legend-color.metalloid { background-color: var(--metalloid-color); }
    .legend-color.nonmetal { background-color: var(--nonmetal-color); }
    .legend-color.halogen { background-color: var(--halogen-color); }
    .legend-color.noble { background-color: var(--noble-gas-color); }
    .legend-color.lanthanide { background-color: var(--lanthanide-color); }
    .legend-color.actinide { background-color: var(--actinide-color); }

    /* Called list container */
    .called-container {
      flex: 1;
      min-width: 300px;
      max-width: 300px;
      margin-left: 20px;
      background: #ffffff;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      overflow: hidden;
      position: relative;
    }
    .called-container h3 {
      margin-top: 0;
      text-align: center;
    }
    .called-container ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 5px;
    }
    .called-container li {
      background: #ddd;
      padding: 5px;
      border-radius: 4px;
      font-size: 14px;
      text-align: center;
    }
    .expand-btn {
      display: none;
      position: absolute;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
    }
    .expand-btn:hover {
      background: #45a049;
    }

    /* Modal styles (for element details) */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
      animation: fadeIn 0.3s;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 320px;
      position: relative;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      animation: slideDown 0.3s;
    }
    .modal-content h2 {
      margin-top: 0;
    }
    .modal-close {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #f44336;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-weight: bold;
    }
    /* Bohr diagram styles */
    .bohr-diagram {
      margin-top: 10px;
      text-align: center;
    }
    .bohr-diagram .shell {
      margin: 4px 0;
      font-size: 14px;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideDown {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* --- Card Generator Styles (scoped to .card-generator-page) --- */
    .card-generator-page {
      display: none; /* Hidden by default */
      padding: var(--spacing-unit);
      background-color: var(--light-gray);
      color: var(--text-color);
      font-size: 1rem;
      line-height: 1.6;
      font-family: var(--font-family-main); /* Apply font to this section */
    }
    .card-generator-page h1 {
      display: flex; /* Make it a flex container */
      align-items: center; /* Vertically align items */
      justify-content: flex-start; /* Start aligning from the left (default for flex) */
      margin-bottom: calc(var(--spacing-unit) * 1.5);
      color: var(--dark-gray);
      font-weight: 600;
      position: relative; /* For positioning the menu button */
    }
    .card-generator-page .header-title {
      flex-grow: 1; /* Allow the title to take up available space */
      text-align: center; /* Center the text within its own flex item */
      margin-left: 10px; /* Small margin to separate from button */
    }
    .card-generator-page .main-container {
      display: flex;
      flex-wrap: wrap;
      gap: calc(var(--spacing-unit) * 1.5);
    }
    .card-generator-page .controls {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-unit);
      flex: 0 0 250px; /* Adjusted from 300px to 250px */
      max-width: 100%;
    }
    .card-generator-page .control-group label {
      display: block;
      margin-bottom: calc(var(--spacing-unit) * 0.25);
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--secondary-color);
    }
    .card-generator-page .control-group input[type="number"],
    .card-generator-page .control-group select {
      width: 100%;
      max-width: 220px;
      box-sizing: border-box;
      padding: 8px 10px;
      border: 1.5px solid var(--border-color);
      border-radius: var(--border-radius);
      background: #fff;
      font-size: 1rem;
      font-family: var(--font-family-main);
      transition: border-color 0.2s, box-shadow 0.2s;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }

    .card-generator-page .control-group input[type="number"]:focus,
    .card-generator-page .control-group select:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 2px rgba(0,123,255,0.15);
    }
    .card-generator-page .control-group button {
      width: 100%; /* Ensure buttons also respect max-width if desired, or keep them full width */
      max-width: 220px; /* Added max-width to buttons for consistency */
      background-color: var(--primary-color);
      color: white;
      font-weight: 600;
      cursor: pointer;
      border-color: var(--primary-color);
      border-radius: var(--border-radius);
      padding: calc(var(--spacing-unit) * 0.5) calc(var(--spacing-unit) * 0.75); /* Ensure consistent padding */
      font-size: 1rem; /* Ensure consistent font size */
    }
    .card-generator-page .control-group button:hover {
      background-color: #0056b3;
      border-color: #0056b3;
    }
    .card-generator-page #pdfBtn {
      background-color: var(--secondary-color);
      border-color: var(--secondary-color);
    }
    .card-generator-page #pdfBtn:hover {
      background-color: #5a6268;
      border-color: #545b62;
    }
    .card-generator-page #infoBox {
      background: #e8f0fe;
      border: 1px solid #a6c8ff;
      padding: var(--spacing-unit);
      border-radius: var(--border-radius);
      margin-top: calc(var(--spacing-unit) * 0.5);
      font-size: 0.875rem;
      line-height: 1.5;
      color: #004085;
    }
    .card-generator-page #infoBox strong {
      color: #003063;
    }
    .card-generator-page #cardsContainer {
      flex-grow: 1;
      display: grid;
      gap: var(--spacing-unit);
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      align-content: start;
    }
    .card-generator-page .bingo-card {
      border: 1px solid var(--card-border-color);
      border-radius: var(--border-radius);
      width: 100%;
      max-width: 300px;
      aspect-ratio: 1 / 1.1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background-color: #fff;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      margin: 0 auto;
    }
    .card-generator-page .card-header {
      background-color: var(--card-header-bg);
      text-align: center;
      font-weight: 600;
      padding: calc(var(--spacing-unit) * 0.3) 0;
      border-bottom: 1px solid var(--card-border-color);
      font-size: 0.8rem;
      color: var(--secondary-color);
      border-top-left-radius: var(--border-radius);
      border-top-right-radius: var(--border-radius);
    }
    .card-generator-page .card-grid {
      width: 100%;
      flex-grow: 1;
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: repeat(5, 1fr);
      border-collapse: collapse;
    }
    .card-generator-page .bingo-cell {
      border: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      font-weight: 600;
      aspect-ratio: 1 / 1;
      text-align: center;
      padding: 2px;
      overflow: hidden;
    }
    .card-generator-page .free {
      background-color: var(--free-cell-bg);
      font-size: 0.9rem;
      font-weight: 400;
      color: var(--secondary-color);
    }
    /* Cell borders for card generator */
    .card-generator-page .card-grid .bingo-cell:nth-child(5n) { border-right: none; }
    .card-generator-page .card-grid .bingo-cell:nth-child(-n+5) { border-top: none; }
    .card-generator-page .card-grid .bingo-cell:nth-child(5n+1) { border-left: none; }
    .card-generator-page .card-grid .bingo-cell:nth-child(n+21) { border-bottom: none; }

    @media (max-width: 768px) {
      .card-generator-page .main-container { flex-direction: column; }
      .card-generator-page .controls { flex-basis: auto; }
      .card-generator-page .bingo-card { max-width: none; }
      .card-generator-page h1 { font-size: 1.5rem; }
    }

    td.recently-called {
      outline: 2px solid rgba(247, 9, 9, 0.669);
      outline-offset: -2px;
      z-index: 2;
      position: relative;
    }

    /* --- New Reset Confirmation Modal Styles --- */
    .reset-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6); /* Semi-transparent black overlay */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000; /* Ensure it's on top */
    }
    .reset-modal-content {
        background-color: #ffffff; /* White background for the modal */
        padding: 2.5rem; /* Increased padding */
        border-radius: 1rem; /* More rounded corners */
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); /* Stronger shadow */
        text-align: center;
        max-width: 90%; /* Responsive width */
        width: 400px; /* Max width for desktop */
        animation: fadeInScale 0.3s ease-out forwards; /* Animation for modal entry */
    }

    /* Keyframe animation for modal entry */
    @keyframes fadeInScale {
        from {
            opacity: 0;
            transform: scale(0.9);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }
  </style>
</head>
<body>
  <!-- Hamburger Menu Overlay -->
  <div class="menu-overlay" id="menuOverlay">
    <div class="menu-content">
      <button class="menu-close" id="menuClose">&times;</button>
      <button id="showCallerBtn">Bingo Caller</button>
      <button id="showGeneratorBtn">Card Generator</button>
    </div>
  </div>

  <!-- Bingo Caller Page -->
  <div id="bingoCallerPage" class="bingo-caller-page">
    <div class="header">
      <button class="menu-button" id="menuButtonCaller">&#9776;</button> <!-- Hamburger icon for Caller page -->
      <div class="current" id="currentElementDisplay">
        Press "Call Next Element" to start!
      </div>
      <div class="header-buttons">
        <button id="callButton">Call Next Element</button>
        <button id="resetButton">Reset</button>
        <!-- Game mode selector added here -->
        <select id="gameMode">
          <option value="fiftySix" selected>56 Elements</option>
          <option value="top70">70 Elements</option>
          <option value="all">All Elements</option>
        </select>
      </div>
    </div>

    <div class="main">
      <div class="table-wrapper">
        <div class="table-container" id="tableContainer">
          <table class="periodic-table">
            <!-- Period 1 -->
            <tr>
              <td id="elem-1" data-atomic="1" data-name="Hydrogen" class="nonmetal">
                H<span class="atomic">1</span>
              </td>
              <td class="empty"></td><td class="empty"></td><td class="empty"></td><td class="empty"></td>
              <td class="empty"></td><td class="empty"></td><td class="empty"></td><td class="empty"></td>
              <td class="empty"></td><td class="empty"></td><td class="empty"></td><td class="empty"></td>
              <td class="empty"></td><td class="empty"></td><td class="empty"></td><td class="empty"></td>
              <td id="elem-2" data-atomic="2" data-name="Helium" class="noble">
                He<span class="atomic">2</span>
              </td>
            </tr>
            <!-- Period 2 -->
            <tr>
              <td id="elem-3" data-atomic="3" data-name="Lithium" class="alkali">
                Li<span class="atomic">3</span>
              </td>
              <td id="elem-4" data-atomic="4" data-name="Beryllium" class="alkaline-earth">
                Be<span class="atomic">4</span>
              </td>
              <td class="empty" colspan="10"></td>
              <td id="elem-5" data-atomic="5" data-name="Boron" class="metalloid">
                B<span class="atomic">5</span>
              </td>
              <td id="elem-6" data-atomic="6" data-name="Carbon" class="nonmetal">
                C<span class="atomic">6</span>
              </td>
              <td id="elem-7" data-atomic="7" data-name="Nitrogen" class="nonmetal">
                N<span class="atomic">7</span>
              </td>
              <td id="elem-8" data-atomic="8" data-name="Oxygen" class="nonmetal">
                O<span class="atomic">8</span>
              </td>
              <td id="elem-9" data-atomic="9" data-name="Fluorine" class="halogen">
                F<span class="atomic">9</span>
              </td>
              <td id="elem-10" data-atomic="10" data-name="Neon" class="noble">
                Ne<span class="atomic">10</span>
              </td>
            </tr>
            <!-- Period 3 -->
            <tr>
              <td id="elem-11" data-atomic="11" data-name="Sodium" class="alkali">
                Na<span class="atomic">11</span>
              </td>
              <td id="elem-12" data-atomic="12" data-name="Magnesium" class="alkaline-earth">
                Mg<span class="atomic">12</span>
              </td>
              <td class="empty" colspan="10"></td>
              <td id="elem-13" data-atomic="13" data-name="Aluminum" class="basic-metal">
                Al<span class="atomic">13</span>
              </td>
              <td id="elem-14" data-atomic="14" data-name="Silicon" class="metalloid">
                Si<span class="atomic">14</span>
              </td>
              <td id="elem-15" data-atomic="15" data-name="Phosphorus" class="nonmetal">
                P<span class="atomic">15</span>
              </td>
              <td id="elem-16" data-atomic="16" data-name="Sulfur" class="nonmetal">
                S<span class="atomic">16</span>
              </td>
              <td id="elem-17" data-atomic="17" data-name="Chlorine" class="halogen">
                Cl<span class="atomic">17</span>
              </td>
              <td id="elem-18" data-atomic="18" data-name="Argon" class="noble">
                Ar<span class="atomic">18</span>
              </td>
            </tr>
            <!-- Period 4 -->
            <tr>
              <td id="elem-19" data-atomic="19" data-name="Potassium" class="alkali">
                K<span class="atomic">19</span>
              </td>
              <td id="elem-20" data-atomic="20" data-name="Calcium" class="alkaline-earth">
                Ca<span class="atomic">20</span>
              </td>
              <td id="elem-21" data-atomic="21" data-name="Scandium" class="transition">
                Sc<span class="atomic">21</span>
              </td>
              <td id="elem-22" data-atomic="22" data-name="Titanium" class="transition">
                Ti<span class="atomic">22</span>
              </td>
              <td id="elem-23" data-atomic="23" data-name="Vanadium" class="transition">
                V<span class="atomic">23</span>
              </td>
              <td id="elem-24" data-atomic="24" data-name="Chromium" class="transition">
                Cr<span class="atomic">24</span>
              </td>
              <td id="elem-25" data-atomic="25" data-name="Manganese" class="transition">
                Mn<span class="atomic">25</span>
              </td>
              <td id="elem-26" data-atomic="26" data-name="Iron" class="transition">
                Fe<span class="atomic">26</span>
              </td>
              <td id="elem-27" data-atomic="27" data-name="Cobalt" class="transition">
                Co<span class="atomic">27</span>
              </td>
              <td id="elem-28" data-atomic="28" data-name="Nickel" class="transition">
                Ni<span class="atomic">28</span>
              </td>
              <td id="elem-29" data-atomic="29" data-name="Copper" class="transition">
                Cu<span class="atomic">29</span>
              </td>
              <td id="elem-30" data-atomic="30" data-name="Zinc" class="transition">
                Zn<span class="atomic">30</span>
              </td>
              <td id="elem-31" data-atomic="31" data-name="Gallium" class="basic-metal">
                Ga<span class="atomic">31</span>
              </td>
              <td id="elem-32" data-atomic="32" data-name="Germanium" class="metalloid">
                Ge<span class="atomic">32</span>
              </td>
              <td id="elem-33" data-atomic="33" data-name="Arsenic" class="metalloid">
                As<span class="atomic">33</span>
              </td>
              <td id="elem-34" data-atomic="34" data-name="Selenium" class="nonmetal">
                Se<span class="atomic">34</span>
              </td>
              <td id="elem-35" data-atomic="35" data-name="Bromine" class="halogen">
                Br<span class="atomic">35</span>
              </td>
              <td id="elem-36" data-atomic="36" data-name="Krypton" class="noble">
                Kr<span class="atomic">36</span>
              </td>
            </tr>
            <!-- Period 5 -->
            <tr>
              <td id="elem-37" data-atomic="37" data-name="Rubidium" class="alkali">
                Rb<span class="atomic">37</span>
              </td>
              <td id="elem-38" data-atomic="38" data-name="Strontium" class="alkaline-earth">
                Sr<span class="atomic">38</span>
              </td>
              <td id="elem-39" data-atomic="39" data-name="Yttrium" class="transition">
                Y<span class="atomic">39</span>
              </td>
              <td id="elem-40" data-atomic="40" data-name="Zirconium" class="transition">
                Zr<span class="atomic">40</span>
              </td>
              <td id="elem-41" data-atomic="41" data-name="Niobium" class="transition">
                Nb<span class="atomic">41</span>
              </td>
              <td id="elem-42" data-atomic="42" data-name="Molybdenum" class="transition">
                Mo<span class="atomic">42</span>
              </td>
              <td id="elem-43" data-atomic="43" data-name="Technetium" class="transition">
                Tc<span class="atomic">43</span>
              </td>
              <td id="elem-44" data-atomic="44" data-name="Ruthenium" class="transition">
                Ru<span class="atomic">44</span>
              </td>
              <td id="elem-45" data-atomic="45" data-name="Rhodium" class="transition">
                Rh<span class="atomic">45</span>
              </td>
              <td id="elem-46" data-atomic="46" data-name="Palladium" class="transition">
                Pd<span class="atomic">46</span>
              </td>
              <td id="elem-47" data-atomic="47" data-name="Silver" class="transition">
                Ag<span class="atomic">47</span>
              </td>
              <td id="elem-48" data-atomic="48" data-name="Cadmium" class="transition">
                Cd<span class="atomic">48</span>
              </td>
              <td id="elem-49" data-atomic="49" data-name="Indium" class="basic-metal">
                In<span class="atomic">49</span>
              </td>
              <td id="elem-50" data-atomic="50" data-name="Tin" class="basic-metal">
                Sn<span class="atomic">50</span>
              </td>
              <td id="elem-51" data-atomic="51" data-name="Antimony" class="metalloid">
                Sb<span class="atomic">51</span>
              </td>
              <td id="elem-52" data-atomic="52" data-name="Tellurium" class="metalloid">
                Te<span class="atomic">52</span>
              </td>
              <td id="elem-53" data-atomic="53" data-name="Iodine" class="halogen">
                I<span class="atomic">53</span>
              </td>
              <td id="elem-54" data-atomic="54" data-name="Xenon" class="noble">
                Xe<span class="atomic">54</span>
              </td>
            </tr>
            <!-- Period 6 -->
            <tr>
              <td id="elem-55" data-atomic="55" data-name="Cesium" class="alkali">
                Cs<span class="atomic">55</span>
              </td>
              <td id="elem-56" data-atomic="56" data-name="Barium" class="alkaline-earth">
                Ba<span class="atomic">56</span>
              </td>
              <td class="empty"></td>
              <td id="elem-72" data-atomic="72" data-name="Hafnium" class="transition">
                Hf<span class="atomic">72</span>
              </td>
              <td id="elem-73" data-atomic="73" data-name="Tantalum" class="transition">
                Ta<span class="atomic">73</span>
              </td>
              <td id="elem-74" data-atomic="74" data-name="Tungsten" class="transition">
                W<span class="atomic">74</span>
              </td>
              <td id="elem-75" data-atomic="75" data-name="Rhenium" class="transition">
                Re<span class="atomic">75</span>
              </td>
              <td id="elem-76" data-atomic="76" data-name="Osmium" class="transition">
                Os<span class="atomic">76</span>
              </td>
              <td id="elem-77" data-atomic="77" data-name="Iridium" class="transition">
                Ir<span class="atomic">77</span>
              </td>
              <td id="elem-78" data-atomic="78" data-name="Platinum" class="transition">
                Pt<span class="atomic">78</span>
              </td>
              <td id="elem-79" data-atomic="79" data-name="Gold" class="basic-metal">
                Au<span class="atomic">79</span>
              </td>
              <td id="elem-80" data-atomic="80" data-name="Mercury" class="basic-metal">
                Hg<span class="atomic">80</span>
              </td>
              <td id="elem-81" data-atomic="81" data-name="Thallium" class="basic-metal">
                Tl<span class="atomic">81</span>
              </td>
              <td id="elem-82" data-atomic="82" data-name="Lead" class="basic-metal">
                Pb<span class="atomic">82</span>
              </td>
              <td id="elem-83" data-atomic="83" data-name="Bismuth" class="basic-metal">
                Bi<span class="atomic">83</span>
              </td>
              <td id="elem-84" data-atomic="84" data-name="Polonium" class="metalloid">
                Po<span class="atomic">84</span>
              </td>
              <td id="elem-85" data-atomic="85" data-name="Astatine" class="halogen">
                At<span class="atomic">85</span>
              </td>
              <td id="elem-86" data-atomic="86" data-name="Radon" class="noble">
                Rn<span class="atomic">86</span>
              </td>
            </tr>
            <!-- Period 7 -->
            <tr>
              <td id="elem-87" data-atomic="87" data-name="Francium" class="alkali">
                Fr<span class="atomic">87</span>
              </td>
              <td id="elem-88" data-atomic="88" data-name="Radium" class="alkaline-earth">
                Ra<span class="atomic">88</span>
              </td>
              <td class="empty"></td>
              <td id="elem-104" data-atomic="104" data-name="Rutherfordium" class="transition">
                Rf<span class="atomic">104</span>
              </td>
              <td id="elem-105" data-atomic="105" data-name="Dubnium" class="transition">
                Db<span class="atomic">105</span>
              </td>
              <td id="elem-106" data-atomic="106" data-name="Seaborgium" class="transition">
                Sg<span class="atomic">106</span>
              </td>
              <td id="elem-107" data-atomic="107" data-name="Bohrium" class="transition">
                Bh<span class="atomic">107</span>
              </td>
              <td id="elem-108" data-atomic="108" data-name="Hassium" class="transition">
                Hs<span class="atomic">108</span>
              </td>
              <td id="elem-109" data-atomic="109" data-name="Meitnerium" class="transition">
                Mt<span class="atomic">109</span>
              </td>
              <td id="elem-110" data-atomic="110" data-name="Darmstadtium" class="transition">
                Ds<span class="atomic">110</span>
              </td>
              <td id="elem-111" data-atomic="111" data-name="Roentgenium" class="transition">
                Rg<span class="atomic">111</span>
              </td>
              <td id="elem-112" data-atomic="112" data-name="Copernicium" class="transition">
                Cn<span class="atomic">112</span>
              </td>
              <td id="elem-113" data-atomic="113" data-name="Nihonium" class="basic-metal">
                Nh<span class="atomic">113</span>
              </td>
              <td id="elem-114" data-atomic="114" data-name="Flerovium" class="basic-metal">
                Fl<span class="atomic">114</span>
              </td>
              <td id="elem-115" data-atomic="115" data-name="Moscovium" class="basic-metal">
                Mc<span class="atomic">115</span>
              </td>
              <td id="elem-116" data-atomic="116" data-name="Livermorium" class="basic-metal">
                Lv<span class="atomic">116</span>
              </td>
              <td id="elem-117" data-atomic="117" data-name="Tennessine" class="halogen">
                Ts<span class="atomic">117</span>
              </td>
              <td id="elem-118" data-atomic="118" data-name="Oganesson" class="noble">
                Og<span class="atomic">118</span>
              </td>
            </tr>
            <!-- Lanthanides -->
            <tr>
              <td class="label" colspan="2">Lanthanides:</td>
              <td id="elem-57" data-atomic="57" data-name="Lanthanum" class="lanthanide">
                La<span class="atomic">57</span>
              </td>
              <td id="elem-58" data-atomic="58" data-name="Cerium" class="lanthanide">
                Ce<span class="atomic">58</span>
              </td>
              <td id="elem-59" data-atomic="59" data-name="Praseodymium" class="lanthanide">
                Pr<span class="atomic">59</span>
              </td>
              <td id="elem-60" data-atomic="60" data-name="Neodymium" class="lanthanide">
                Nd<span class="atomic">60</span>
              </td>
              <td id="elem-61" data-atomic="61" data-name="Promethium" class="lanthanide">
                Pm<span class="atomic">61</span>
              </td>
              <td id="elem-62" data-atomic="62" data-name="Samarium" class="lanthanide">
                Sm<span class="atomic">62</span>
              </td>
              <td id="elem-63" data-atomic="63" data-name="Europium" class="lanthanide">
                Eu<span class="atomic">63</span>
              </td>
              <td id="elem-64" data-atomic="64" data-name="Gadolinium" class="lanthanide">
                Gd<span class="atomic">64</span>
              </td>
              <td id="elem-65" data-atomic="65" data-name="Terbium" class="lanthanide">
                Tb<span class="atomic">65</span>
              </td>
              <td id="elem-66" data-atomic="66" data-name="Dysprosium" class="lanthanide">
                Dy<span class="atomic">66</span>
              </td>
              <td id="elem-67" data-atomic="67" data-name="Holmium" class="lanthanide">
                Ho<span class="atomic">67</span>
              </td>
              <td id="elem-68" data-atomic="68" data-name="Erbium" class="lanthanide">
                Er<span class="atomic">68</span>
              </td>
              <td id="elem-69" data-atomic="69" data-name="Thulium" class="lanthanide">
                Tm<span class="atomic">69</span>
              </td>
              <td id="elem-70" data-atomic="70" data-name="Ytterbium" class="lanthanide">
                Yb<span class="atomic">70</span>
              </td>
              <td id="elem-71" data-atomic="71" data-name="Lutetium" class="lanthanide">
                Lu<span class="atomic">71</span>
              </td>
              <td class="empty" colspan="2"></td>
            </tr>
            <!-- Actinides -->
            <tr>
              <td class="label" colspan="2">Actinides:</td>
              <td id="elem-89" data-atomic="89" data-name="Actinium" class="actinide">
                Ac<span class="atomic">89</span>
              </td>
              <td id="elem-90" data-atomic="90" data-name="Thorium" class="actinide">
                Th<span class="atomic">90</span>
              </td>
              <td id="elem-91" data-atomic="91" data-name="Protactinium" class="actinide">
                Pa<span class="atomic">91</span>
              </td>
              <td id="elem-92" data-atomic="92" data-name="Uranium" class="actinide">
                U<span class="atomic">92</span>
              </td>
              <td id="elem-93" data-atomic="93" data-name="Neptunium" class="actinide">
                Np<span class="atomic">93</span>
              </td>
              <td id="elem-94" data-atomic="94" data-name="Plutonium" class="actinide">
                Pu<span class="atomic">94</span>
              </td>
              <td id="elem-95" data-atomic="95" data-name="Americium" class="actinide">
                Am<span class="atomic">95</span>
              </td>
              <td id="elem-96" data-atomic="96" data-name="Curium" class="actinide">
                Cm<span class="atomic">96</span>
              </td>
              <td id="elem-97" data-atomic="97" data-name="Berkelium" class="actinide">
                Bk<span class="atomic">97</span>
              </td>
              <td id="elem-98" data-atomic="98" data-name="Californium" class="actinide">
                Cf<span class="atomic">98</span>
              </td>
              <td id="elem-99" data-atomic="99" data-name="Einsteinium" class="actinide">
                Es<span class="atomic">99</span>
              </td>
              <td id="elem-100" data-atomic="100" data-name="Fermium" class="actinide">
                Fm<span class="atomic">100</span>
              </td>
              <td id="elem-101" data-atomic="101" data-name="Mendelevium" class="actinide">
                Md<span class="atomic">101</span>
              </td>
              <td id="elem-102" data-atomic="102" data-name="Nobelium" class="actinide">
                No<span class="atomic">102</span>
              </td>
              <td id="elem-103" data-atomic="103" data-name="Lawrencium" class="actinide">
                Lr<span class="atomic">103</span>
              </td>
              <td class="empty" colspan="2"></td>
            </tr>
          </table>
        </div>
        <!-- Legend for element families -->
        <div class="legend">
          <div class="legend-item"><span class="legend-color alkali"></span> Alkali Metals</div>
          <div class="legend-item"><span class="legend-color alkaline-earth"></span> Alkaline Earth Metals</div>
          <div class="legend-item"><span class="legend-color transition"></span> Transition Metals</div>
          <div class="legend-item"><span class="legend-color basic-metal"></span> Basic Metals</div>
          <div class="legend-item"><span class="legend-color metalloid"></span> Metalloids</div>
          <div class="legend-item"><span class="legend-color nonmetal"></span> Nonmetals</div>
          <div class="legend-item"><span class="legend-color halogen"></span> Halogens</div>
          <div class="legend-item"><span class="legend-color noble"></span> Noble Gases</div>
          <div class="legend-item"><span class="legend-color lanthanide"></span> Lanthanides</div>
          <div class="legend-item"><span class="legend-color actinide"></span> Actinides</div>
        </div>
      </div>

      <div class="called-container" id="calledContainer">
        <h3>Called Elements</h3>
        <ul id="calledList"></ul>
        <button class="expand-btn" id="toggleExpandButton">Expand</button>
      </div>
    </div>

    <!-- Modal for element details -->
    <div class="modal-overlay" id="elementModal">
      <div class="modal-content" id="modalContent">
        <button class="modal-close" id="modalClose">&times;</button>
        <h2 id="modalName">Element Name</h2>
        <p><strong>Atomic Number:</strong> <span id="modalAtomic"></span></p>
        <p><strong>Atomic Mass:</strong> <span id="modalMass"></span></p>
        <p><strong>Common Ionic Charges:</strong> <span id="modalCharges"></span></p>
        <p><strong>State at STP:</strong> <span id="modalState"></span></p>
        <div id="bohrDiagram"></div>
      </div>
    </div>
  </div>

  <!-- Card Generator Page -->
  <div id="cardGeneratorPage" class="card-generator-page">
    <h1>
      <button class="menu-button" id="menuButtonGenerator">&#9776;</button> <!-- Hamburger icon for Generator page -->
      <span class="header-title">Element Bingo Card Generator</span>
    </h1>
    <div class="main-container">
      <div class="controls">
        <div class="control-group"> <label for="numCards">Number of Cards:</label> <input type="number" id="numCards" value="30" min="1" /> </div>
        <div class="control-group"> <label for="cardsPerPage">Cards per Page (for Print):</label> <select id="cardsPerPage"> <option value="1">1</option> <option value="2" selected>2</option> <option value="4">4</option> </select> </div>
        <div class="control-group"> <label for="elementSet">Element Set:</label> <select id="elementSet"> <option value="fiftySix" selected>56 Common Elements</option> <option value="top70">70 Common Elements</option> <option value="all">118 All Known Elements</option> </select> </div>
        <div class="control-group"> <label for="paperSize">Paper Size (for Print):</label> <select id="paperSize"> <option value="letter" selected>Letter (8.5 x 11 in)</option> <option value="A4">A4 (210 x 297 mm)</option> </select> </div>
        <div class="control-group"> <label for="fontChoice">Font Choice (Screen Preview):</label> <select id="fontChoice"> <option value="'Poppins', Arial, sans-serif" selected>Poppins</option> <option value="'Times New Roman', Times, serif">Times New Roman</option> <option value="'Courier New', Courier, monospace">Courier New</option> <option value="Verdana, Geneva, sans-serif">Verdana</option> </select> </div>
        <div class="control-group"> <button id="generate">Randomize</button> </div>
        <div class="control-group"> <button id="pdfBtn">Generate & Print</button> </div>
        <div id="infoBox"> Select options and click "Randomize" to see cards and probabilities. </div>
      </div>
      <div id="cardsContainer"></div>
    </div>
  </div>

  <!-- Reset Confirmation Modal Structure -->
  <div id="resetConfirmationModal" class="reset-modal-overlay hidden">
      <div class="reset-modal-content">
          <h2 class="text-2xl font-bold text-gray-900 mb-4">Confirm Reset</h2>
          <p class="text-gray-700 mb-6">Are you sure you want to reset? This action cannot be undone.</p>
          <div class="flex justify-center space-x-4">
              <button id="cancelResetButton" class="px-6 py-3 bg-gray-300 text-gray-800 font-semibold rounded-lg shadow-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-opacity-75 transition duration-200 ease-in-out">
                  Cancel
              </button>
              <button id="confirmResetButton" class="px-6 py-3 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-75 transition duration-200 ease-in-out">
                  Reset Anyway
              </button>
          </div>
      </div>
  </div>

  <script>
    // --- Global Page Management ---
    const bingoCallerPage = document.getElementById('bingoCallerPage');
    const cardGeneratorPage = document.getElementById('cardGeneratorPage');
    const menuOverlay = document.getElementById('menuOverlay');
    const menuClose = document.getElementById('menuClose');
    const showCallerBtn = document.getElementById('showCallerBtn');
    const showGeneratorBtn = document.getElementById('showGeneratorBtn');

    // Get both menu buttons
    const menuButtonCaller = document.getElementById('menuButtonCaller');
    const menuButtonGenerator = document.getElementById('menuButtonGenerator');

    function showPage(pageId) {
      bingoCallerPage.style.display = 'none';
      cardGeneratorPage.style.display = 'none';
      if (pageId === 'bingoCaller') {
        bingoCallerPage.style.display = 'block';
        document.title = "Chemistry Element Bingo Caller"; // Update title
      } else if (pageId === 'cardGenerator') {
        cardGeneratorPage.style.display = 'block';
        document.title = "Element Bingo Card Generator"; // Update title
        // Ensure card generator elements are initialized/updated when shown
        if (!cardGeneratorPage.dataset.initialized) {
            setupCardGeneratorListeners();
            generatePreview(); // Generate initial preview
            cardGeneratorPage.dataset.initialized = 'true';
        }
      }
      hideMenu();
    }

    function toggleMenu() {
      menuOverlay.classList.toggle('open');
    }

    function hideMenu() {
      menuOverlay.classList.remove('open');
    }

    // --- Centralized Element Data ---
    // Detailed data for all 118 elements. This remains the primary source of element information.
    const elementDetails = {
      "1": { name: "Hydrogen", symbol: "H", atomicNumber: 1, atomicMass: "1.008 u", commonIonicCharges: ["+1", "-1"], state: "gas" },
      "2": { name: "Helium", symbol: "He", atomicNumber: 2, atomicMass: "4.0026 u", commonIonicCharges: [], state: "gas" },
      "3": { name: "Lithium", symbol: "Li", atomicNumber: 3, atomicMass: "6.94 u", commonIonicCharges: ["+1"], state: "solid" },
      "4": { name: "Beryllium", symbol: "Be", atomicNumber: 4, atomicMass: "9.0122 u", commonIonicCharges: ["+2"], state: "solid" },
      "5": { name: "Boron", symbol: "B", atomicNumber: 5, atomicMass: "10.81 u", commonIonicCharges: ["+3"], state: "solid" },
      "6": { name: "Carbon", symbol: "C", atomicNumber: 6, atomicMass: "12.011 u", commonIonicCharges: ["+4", "-4"], state: "solid" },
      "7": { name: "Nitrogen", symbol: "N", atomicNumber: 7, atomicMass: "14.007 u", commonIonicCharges: ["-3"], state: "gas" },
      "8": { name: "Oxygen", symbol: "O", atomicNumber: 8, atomicMass: "15.999 u", commonIonicCharges: ["-2"], state: "gas" },
      "9": { name: "Fluorine", symbol: "F", atomicNumber: 9, atomicMass: "18.998 u", commonIonicCharges: ["-1"], state: "gas" },
      "10": { name: "Neon", symbol: "Ne", atomicNumber: 10, atomicMass: "20.180 u", commonIonicCharges: [], state: "gas" },
      "11": { name: "Sodium", symbol: "Na", atomicNumber: 11, atomicMass: "22.990 u", commonIonicCharges: ["+1"], state: "solid" },
      "12": { name: "Magnesium", symbol: "Mg", atomicNumber: 12, atomicMass: "24.305 u", commonIonicCharges: ["+2"], state: "solid" },
      "13": { name: "Aluminum", symbol: "Al", atomicNumber: 13, atomicMass: "26.982 u", commonIonicCharges: ["+3"], state: "solid" },
      "14": { name: "Silicon", symbol: "Si", atomicNumber: 14, atomicMass: "28.085 u", commonIonicCharges: ["+4", "-4"], state: "solid" },
      "15": { name: "Phosphorus", symbol: "P", atomicNumber: 15, atomicMass: "30.974 u", commonIonicCharges: ["-3", "+3", "+5"], state: "solid" },
      "16": { name: "Sulfur", symbol: "S", atomicNumber: 16, atomicMass: "32.06 u", commonIonicCharges: ["-2"], state: "solid" },
      "17": { name: "Chlorine", symbol: "Cl", atomicNumber: 17, atomicMass: "35.45 u", commonIonicCharges: ["-1"], state: "gas" },
      "18": { name: "Argon", symbol: "Ar", atomicNumber: 18, atomicMass: "39.948 u", commonIonicCharges: [], state: "gas" },
      "19": { name: "Potassium", symbol: "K", atomicNumber: 19, atomicMass: "39.098 u", commonIonicCharges: ["+1"], state: "solid" },
      "20": { name: "Calcium", symbol: "Ca", atomicNumber: 20, atomicMass: "40.078 u", commonIonicCharges: ["+2"], state: "solid" },
      "21": { name: "Scandium", symbol: "Sc", atomicNumber: 21, atomicMass: "44.956 u", commonIonicCharges: ["+3"], state: "solid" },
      "22": { name: "Titanium", symbol: "Ti", atomicNumber: 22, atomicMass: "47.867 u", commonIonicCharges: ["+4"], state: "solid" },
      "23": { name: "Vanadium", symbol: "V", atomicNumber: 23, atomicMass: "50.942 u", commonIonicCharges: ["+3", "+4", "+5"], state: "solid" },
      "24": { name: "Chromium", symbol: "Cr", atomicNumber: 24, atomicMass: "51.996 u", commonIonicCharges: ["+2", "+3", "+6"], state: "solid" },
      "25": { name: "Manganese", symbol: "Mn", atomicNumber: 25, atomicMass: "54.938 u", commonIonicCharges: ["+2", "+3", "+4", "+7"], state: "solid" },
      "26": { name: "Iron", symbol: "Fe", atomicNumber: 26, atomicMass: "55.845 u", commonIonicCharges: ["+2", "+3"], state: "solid" },
      "27": { name: "Cobalt", symbol: "Co", atomicNumber: 27, atomicMass: "58.933 u", commonIonicCharges: ["+2", "+3"], state: "solid" },
      "28": { name: "Nickel", symbol: "Ni", atomicNumber: 28, atomicMass: "58.693 u", commonIonicCharges: ["+2"], state: "solid" },
      "29": { name: "Copper", symbol: "Cu", atomicNumber: 29, atomicMass: "63.546 u", commonIonicCharges: ["+1", "+2"], state: "solid" },
      "30": { name: "Zinc", symbol: "Zn", atomicNumber: 30, atomicMass: "65.38 u", commonIonicCharges: ["+2"], state: "solid" },
      "31": { name: "Gallium", symbol: "Ga", atomicNumber: 31, atomicMass: "69.723 u", commonIonicCharges: ["+3"], state: "solid" },
      "32": { name: "Germanium", symbol: "Ge", atomicNumber: 32, atomicMass: "72.63 u", commonIonicCharges: ["+4"], state: "solid" },
      "33": { name: "Arsenic", symbol: "As", atomicNumber: 33, atomicMass: "74.922 u", commonIonicCharges: ["-3", "+3", "+5"], state: "solid" },
      "34": { name: "Selenium", symbol: "Se", atomicNumber: 34, atomicMass: "78.971 u", commonIonicCharges: ["-2"], state: "solid" },
      "35": { name: "Bromine", symbol: "Br", atomicNumber: 35, atomicMass: "79.904 u", commonIonicCharges: ["-1"], state: "liquid" },
      "36": { name: "Krypton", symbol: "Kr", atomicNumber: 36, atomicMass: "83.798 u", commonIonicCharges: [], state: "gas" },
      "37": { name: "Rubidium", symbol: "Rb", atomicNumber: 37, atomicMass: "85.468 u", commonIonicCharges: ["+1"], state: "solid" },
      "38": { name: "Strontium", symbol: "Sr", atomicNumber: 38, atomicMass: "87.62 u", commonIonicCharges: ["+2"], state: "solid" },
      "39": { name: "Yttrium", symbol: "Y", atomicNumber: 39, atomicMass: "88.906 u", commonIonicCharges: ["+3"], state: "solid" },
      "40": { name: "Zirconium", symbol: "Zr", atomicNumber: 40, atomicMass: "91.224 u", commonIonicCharges: ["+4"], state: "solid" },
      "41": { name: "Niobium", symbol: "Nb", atomicNumber: 41, atomicMass: "92.906 u", commonIonicCharges: ["+5"], state: "solid" },
      "42": { name: "Molybdenum", symbol: "Mo", atomicNumber: 42, atomicMass: "95.95 u", commonIonicCharges: ["+6"], state: "solid" },
      "43": { name: "Technetium", symbol: "Tc", atomicNumber: 43, atomicMass: "(98) u", commonIonicCharges: ["+7"], state: "synthetic" },
      "44": { name: "Ruthenium", symbol: "Ru", atomicNumber: 44, atomicMass: "101.07 u", commonIonicCharges: ["+3", "+4"], state: "solid" },
      "45": { name: "Rhodium", symbol: "Rh", atomicNumber: 45, atomicMass: "102.91 u", commonIonicCharges: ["+3"], state: "solid" },
      "46": { name: "Palladium", symbol: "Pd", atomicNumber: 46, atomicMass: "106.42 u", commonIonicCharges: ["+2", "+4"], state: "solid" },
      "47": { name: "Silver", symbol: "Ag", atomicNumber: 47, atomicMass: "107.87 u", commonIonicCharges: ["+1"], state: "solid" },
      "48": { name: "Cadmium", symbol: "Cd", atomicNumber: 48, atomicMass: "112.41 u", commonIonicCharges: ["+2"], state: "solid" },
      "49": { name: "Indium", symbol: "In", atomicNumber: 49, atomicMass: "114.82 u", commonIonicCharges: ["+3"], state: "solid" },
      "50": { name: "Tin", symbol: "Sn", atomicNumber: 50, atomicMass: "118.71 u", commonIonicCharges: ["+2", "+4"], state: "solid" },
      "51": { name: "Antimony", symbol: "Sb", atomicNumber: 51, atomicMass: "121.76 u", commonIonicCharges: ["-3", "+3", "+5"], state: "solid" },
      "52": { name: "Tellurium", symbol: "Te", atomicNumber: 52, atomicMass: "127.60 u", commonIonicCharges: ["-2", "+4", "+6"], state: "solid" },
      "53": { name: "Iodine", symbol: "I", atomicNumber: 53, atomicMass: "126.90 u", commonIonicCharges: ["-1"], state: "solid" },
      "54": { name: "Xenon", symbol: "Xe", atomicNumber: 54, atomicMass: "131.29 u", commonIonicCharges: [], state: "gas" },
      "55": { name: "Cesium", symbol: "Cs", atomicNumber: 55, atomicMass: "132.91 u", commonIonicCharges: ["+1"], state: "solid" },
      "56": { name: "Barium", symbol: "Ba", atomicNumber: 56, atomicMass: "137.33 u", commonIonicCharges: ["+2"], state: "solid" },
      "57": { name: "Lanthanum", symbol: "La", atomicNumber: 57, atomicMass: "138.91 u", commonIonicCharges: ["+3"], state: "solid" },
      "58": { name: "Cerium", symbol: "Ce", atomicNumber: 58, atomicMass: "140.12 u", commonIonicCharges: ["+3", "+4"], state: "solid" },
      "59": { name: "Praseodymium", symbol: "Pr", atomicNumber: 59, atomicMass: "140.91 u", commonIonicCharges: ["+3"], state: "solid" },
      "60": { name: "Neodymium", symbol: "Nd", atomicNumber: 60, atomicMass: "144.24 u", commonIonicCharges: ["+3"], state: "solid" },
      "61": { name: "Promethium", symbol: "Pm", atomicNumber: 61, atomicMass: "(145) u", commonIonicCharges: ["+3"], state: "synthetic" },
      "62": { name: "Samarium", symbol: "Sm", atomicNumber: 62, atomicMass: "150.36 u", commonIonicCharges: ["+2", "+3"], state: "solid" },
      "63": { name: "Europium", symbol: "Eu", atomicNumber: 63, atomicMass: "151.96 u", commonIonicCharges: ["+2", "+3"], state: "solid" },
      "64": { name: "Gadolinium", symbol: "Gd", atomicNumber: 64, atomicMass: "157.25 u", commonIonicCharges: ["+3"], state: "solid" },
      "65": { name: "Terbium", symbol: "Tb", atomicNumber: 65, atomicMass: "158.93 u", commonIonicCharges: ["+3", "+4"], state: "solid" },
      "66": { name: "Dysprosium", symbol: "Dy", atomicNumber: 66, atomicMass: "162.50 u", commonIonicCharges: ["+3"], state: "solid" },
      "67": { name: "Holmium", symbol: "Ho", atomicNumber: 67, atomicMass: "164.93 u", commonIonicCharges: ["+3"], state: "solid" },
      "68": { name: "Erbium", symbol: "Er", atomicNumber: 68, atomicMass: "167.26 u", commonIonicCharges: ["+3"], state: "solid" },
      "69": { name: "Thulium", symbol: "Tm", atomicNumber: 69, atomicMass: "168.93 u", commonIonicCharges: ["+2", "+3"], state: "solid" },
      "70": { name: "Ytterbium", symbol: "Yb", atomicNumber: 70, atomicMass: "173.05 u", commonIonicCharges: ["+2", "+3"], state: "solid" },
      "71": { name: "Lutetium", symbol: "Lu", atomicNumber: 71, atomicMass: "174.97 u", commonIonicCharges: ["+3"], state: "solid" },
      "72": { name: "Hafnium", symbol: "Hf", atomicNumber: 72, atomicMass: "178.49 u", commonIonicCharges: ["+4"], state: "solid" },
      "73": { name: "Tantalum", symbol: "Ta", atomicNumber: 73, atomicMass: "180.95 u", commonIonicCharges: ["+5"], state: "solid" },
      "74": { name: "Tungsten", symbol: "W", atomicNumber: 74, atomicMass: "183.84 u", commonIonicCharges: ["+6"], state: "solid" },
      "75": { name: "Rhenium", symbol: "Re", atomicNumber: 75, atomicMass: "186.21 u", commonIonicCharges: ["+7"], state: "solid" },
      "76": { name: "Osmium", symbol: "Os", atomicNumber: 76, atomicMass: "190.23 u", commonIonicCharges: ["+4"], state: "solid" },
      "77": { name: "Iridium", symbol: "Ir", atomicNumber: 77, atomicMass: "192.22 u", commonIonicCharges: ["+3", "+4"], state: "solid" },
      "78": { name: "Platinum", symbol: "Pt", atomicNumber: 78, atomicMass: "195.08 u", commonIonicCharges: ["+2", "+4"], state: "solid" },
      "79": { name: "Gold", symbol: "Au", atomicNumber: 79, atomicMass: "196.97 u", commonIonicCharges: ["+1", "+3"], state: "solid" },
      "80": { name: "Mercury", symbol: "Hg", atomicNumber: 80, atomicMass: "200.59 u", commonIonicCharges: ["+1", "+2"], state: "liquid" },
      "81": { name: "Thallium", symbol: "Tl", atomicNumber: 81, atomicMass: "204.38 u", commonIonicCharges: ["+1", "+3"], state: "solid" },
      "82": { name: "Lead", symbol: "Pb", atomicNumber: 82, atomicMass: "207.2 u", commonIonicCharges: ["+2", "+4"], state: "solid" },
      "83": { name: "Bismuth", symbol: "Bi", atomicNumber: 83, atomicMass: "208.98 u", commonIonicCharges: ["+3"], state: "solid" },
      "84": { name: "Polonium", symbol: "Po", atomicNumber: 84, atomicMass: "(209) u", commonIonicCharges: ["+2", "+4"], state: "solid" },
      "85": { name: "Astatine", symbol: "At", atomicNumber: 85, atomicMass: "(210) u", commonIonicCharges: ["-1", "+1"], state: "solid" },
      "86": { name: "Radon", symbol: "Rn", atomicNumber: 86, atomicMass: "(222) u", commonIonicCharges: [], state: "gas" },
      "87": { name: "Francium", symbol: "Fr", atomicNumber: 87, atomicMass: "(223) u", commonIonicCharges: ["+1"], state: "synthetic" },
      "88": { name: "Radium", symbol: "Ra", atomicNumber: 88, atomicMass: "(226) u", commonIonicCharges: ["+2"], state: "synthetic" },
      "89": { name: "Actinium", symbol: "Ac", atomicNumber: 89, atomicMass: "(227) u", commonIonicCharges: ["+3"], state: "synthetic" },
      "90": { name: "Thorium", symbol: "Th", atomicNumber: 90, atomicMass: "232.04 u", commonIonicCharges: ["+4"], state: "solid" },
      "91": { name: "Protactinium", symbol: "Pa", atomicNumber: 91, atomicMass: "231.04 u", commonIonicCharges: ["+4", "+5"], state: "solid" },
      "92": { name: "Uranium", symbol: "U", atomicNumber: 92, atomicMass: "238.03 u", commonIonicCharges: ["+3", "+4", "+6"], state: "solid" },
      "93": { name: "Neptunium", symbol: "Np", atomicNumber: 93, atomicMass: "(237) u", commonIonicCharges: ["+3", "+4", "+5", "+6"], state: "synthetic" },
      "94": { name: "Plutonium", symbol: "Pu", atomicNumber: 94, atomicMass: "(244) u", commonIonicCharges: ["+3", "+4"], state: "synthetic" },
      "95": { name: "Americium", symbol: "Am", atomicNumber: 95, atomicMass: "(243) u", commonIonicCharges: ["+3"], state: "synthetic" },
      "96": { name: "Curium", symbol: "Cm", atomicNumber: 96, atomicMass: "(247) u", commonIonicCharges: ["+3"], state: "synthetic" },
      "97": { name: "Berkelium", symbol: "Bk", atomicNumber: 97, atomicMass: "(247) u", commonIonicCharges: ["+3", "+4"], state: "synthetic" },
      "98": { name: "Californium", symbol: "Cf", atomicNumber: 98, atomicMass: "(251) u", commonIonicCharges: ["+3"], state: "synthetic" },
      "99": { name: "Einsteinium", symbol: "Es", atomicNumber: 99, atomicMass: "(252) u", commonIonicCharges: ["+2", "+3"], state: "synthetic" },
      "100": { name: "Fermium", symbol: "Fm", atomicNumber: 100, atomicMass: "(257) u", commonIonicCharges: ["+2", "+3"], state: "synthetic" },
      "101": { name: "Mendelevium", symbol: "Md", atomicNumber: 101, atomicMass: "(258) u", commonIonicCharges: ["+2", "+3"], state: "synthetic" },
      "102": { name: "Nobelium", symbol: "No", atomicNumber: 102, atomicMass: "(259) u", commonIonicCharges: ["+2", "+3"], state: "synthetic" },
      "103": { name: "Lawrencium", symbol: "Lr", atomicNumber: 103, atomicMass: "(262) u", commonIonicCharges: ["+3"], state: "synthetic" },
      "104": { name: "Rutherfordium", symbol: "Rf", atomicNumber: 104, atomicMass: "(267) u", commonIonicCharges: ["+4"], state: "synthetic" },
      "105": { name: "Dubnium", symbol: "Db", atomicNumber: 105, atomicMass: "(268) u", commonIonicCharges: ["+5"], state: "synthetic" },
      "106": { name: "Seaborgium", symbol: "Sg", atomicNumber: 106, atomicMass: "(271) u", commonIonicCharges: ["+6"], state: "synthetic" },
      "107": { name: "Bohrium", symbol: "Bh", atomicNumber: 107, atomicMass: "(272) u", commonIonicCharges: ["+7"], state: "synthetic" },
      "108": { name: "Hassium", symbol: "Hs", atomicNumber: 108, atomicMass: "(277) u", commonIonicCharges: ["+8"], state: "synthetic" },
      "109": { name: "Meitnerium", symbol: "Mt", atomicNumber: 109, atomicMass: "(276) u", commonIonicCharges: ["+9"], state: "synthetic" },
      "110": { name: "Darmstadtium", symbol: "Ds", atomicNumber: 110, atomicMass: "(281) u", commonIonicCharges: ["+10"], state: "synthetic" },
      "111": { name: "Roentgenium", symbol: "Rg", atomicNumber: 111, atomicMass: "(280) u", commonIonicCharges: ["+11"], state: "synthetic" },
      "112": { name: "Copernicium", symbol: "Cn", atomicNumber: 112, atomicMass: "(285) u", commonIonicCharges: ["+12"], state: "synthetic" },
      "113": { name: "Nihonium", symbol: "Nh", atomicNumber: 113, atomicMass: "(286) u", commonIonicCharges: ["+1"], state: "synthetic" },
      "114": { name: "Flerovium", symbol: "Fl", atomicNumber: 114, atomicMass: "(289) u", commonIonicCharges: ["+2"], state: "synthetic" },
      "115": { name: "Moscovium", symbol: "Mc", atomicNumber: 115, atomicMass: "(290) u", commonIonicCharges: ["+1"], state: "synthetic" },
      "116": { name: "Livermorium", symbol: "Lv", atomicNumber: 116, atomicMass: "(293) u", commonIonicCharges: ["+2"], state: "synthetic" },
      "117": { name: "Tennessine", symbol: "Ts", atomicNumber: 117, atomicMass: "(294) u", commonIonicCharges: ["-1"], state: "synthetic" },
      "118": { name: "Oganesson", symbol: "Og", atomicNumber: 118, atomicMass: "(294) u", commonIonicCharges: [], state: "synthetic" }
    };

    // Centralized definitions of element sets by atomic number
    const ELEMENT_SETS_ATOMIC_NUMBERS = {
      all: Array.from({ length: 118 }, (_, i) => i + 1), // All 118 elements
      top70: [ // Top 70 Common Elements
        1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
        11, 12, 13, 14, 15, 16, 17, 18,
        19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,
        37, 38, 40, 41, 42, 46, 47, 48, 49, 50, 51, 52, 53, 54,
        55, 56, 74, 78, 79, 80, 81, 82, 83, 84, 85, 86,
        87, 88, 92, 94, 96, 99, 101, 102
      ],
      fiftySix: [ // 56 Common Elements
        1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
        11, 12, 13, 14, 15, 16, 17, 18,
        19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,
        37, 38, 47, 48, 50, 51, 53, 54, 55, 56, 74, 78, 79, 80, 82, 86, 87, 88, 92, 94
      ]
    };

    /**
     * Retrieves an array of atomic numbers for a given game mode.
     * @param {string} mode - The game mode ('all', 'top70', 'fiftySix').
     * @returns {number[]} An array of atomic numbers.
     */
    function getAtomicNumbersForMode(mode) {
      return ELEMENT_SETS_ATOMIC_NUMBERS[mode] ? ELEMENT_SETS_ATOMIC_NUMBERS[mode].slice() : [];
    }

    /**
     * Retrieves an array of element symbols for a given element set.
     * @param {string} set - The element set ('all', 'top70', 'fiftySix').
     * @returns {string[]} An array of element symbols.
     */
    function getSymbolsForSet(set) {
      const atomicNumbers = ELEMENT_SETS_ATOMIC_NUMBERS[set];
      if (!atomicNumbers) return [];
      return atomicNumbers.map(num => elementDetails[num].symbol);
    }

    // --- Element Bingo Caller Script ---
    // Simple function to determine approximate electron shell configuration.
    function getElectronShells(Z) {
      let shells = [];
      const capacities = [2, 8, 18, 32, 18, 8]; // simplified capacities
      for (let cap of capacities) {
        if (Z > cap) {
          shells.push(cap);
          Z -= cap;
        } else {
          shells.push(Z);
          Z = 0;
          break;
        }
      }
      return shells;
    }
    function createBohrDiagram(atomicNumber) {
      const shells = getElectronShells(Number(atomicNumber));
      let html = '<div class="bohr-diagram"><strong>Bohr Diagram:</strong><br>';
      shells.forEach((electrons, index) => {
        html += `<div class="shell">Shell ${index+1}: ${electrons} e</div>`;
      });
      html += '</div>';
      return html;
    }

    // Family assignment function based on atomic number.
    function assignFamilies() {
      document.querySelectorAll('td[id^="elem-"]').forEach(cell => {
        let atomic = Number(cell.getAttribute('data-atomic'));
        // Remove any previously assigned family classes.
        cell.classList.remove('alkali', 'alkaline-earth', 'transition', 'basic-metal', 'metalloid', 'nonmetal', 'halogen', 'noble', 'lanthanide', 'actinide');
        if ([3,11,19,37,55,87].includes(atomic)) {
          cell.classList.add('alkali');
        } else if ([4,12,20,38,56,88].includes(atomic)) {
          cell.classList.add('alkaline-earth');
        } else if ((atomic >= 21 && atomic <= 30) || (atomic >= 39 && atomic <= 48) ||
                   (atomic >= 72 && atomic <= 80) || (atomic >= 104 && atomic <= 112)) {
          cell.classList.add('transition');
        } else if ([13,31,49,50,81,82,83].includes(atomic)) {
          cell.classList.add('basic-metal');
        } else if ([5,14,32,33,51,52].includes(atomic)) {
          cell.classList.add('metalloid');
        } else if ([1,6,7,8,15,16,34].includes(atomic)) {
          cell.classList.add('nonmetal');
        } else if ([9,17,35,53,85].includes(atomic)) {
          cell.classList.add('halogen');
        } else if ([2,10,18,36,54,86].includes(atomic)) {
          cell.classList.add('noble');
        } else if (atomic >= 57 && atomic <= 71) {
          cell.classList.add('lanthanide');
        } else if (atomic >= 89 && atomic <= 103) {
          cell.classList.add('actinide');
        }
        // Additional explicit assignments for exceptions:
        else if (atomic === 84) {
          cell.classList.add('metalloid');
        } else if (atomic >= 113 && atomic <= 115) {
          cell.classList.add('basic-metal');
        } else if (atomic === 116) {
          cell.classList.add('basic-metal');
        } else if (atomic === 117) {
          cell.classList.add('halogen');
        } else if (atomic === 118) {
          cell.classList.add('noble');
        }
      });
    }

    let remainingElements, currentElement;
    let collapsedHeight = 0;
    let desiredCollapseHeight = 0; // global variable for our desired collapse height
    let isExpanded = false;
    const rowHeight = 50;

    function initBingoCaller() {
      const gameModeSelector = document.getElementById('gameMode');
      const currentElementDisplay = document.getElementById('currentElementDisplay');
      const calledList = document.getElementById('calledList');
      const calledContainer = document.getElementById('calledContainer');
      const toggleExpandButton = document.getElementById('toggleExpandButton');

      // Get elements based on selected game mode from the centralized source
      remainingElements = getAtomicNumbersForMode(gameModeSelector.value);

      // Reset each cells state.
      for (let i = 1; i <= 118; i++) {
        const cell = document.getElementById('elem-' + i);
        if (cell) {
          cell.classList.remove('current', 'called', 'recently-called'); // Also remove recently-called
        }
      }
      currentElement = null;
      currentElementDisplay.textContent = 'Element BINGO!';
      calledList.innerHTML = '';
      const tableWrapper = document.querySelector('.table-wrapper');
      desiredCollapseHeight = tableWrapper.offsetHeight - 20; // 20px shorter than the table wrapper
      collapsedHeight = desiredCollapseHeight;
      calledContainer.style.height = desiredCollapseHeight + "px";
      isExpanded = false;
      toggleExpandButton.style.display = "none";
      toggleExpandButton.textContent = "Expand";
      assignFamilies();
    }

    function checkOverflow() {
      const calledContainer = document.getElementById('calledContainer');
      const calledList = document.getElementById('calledList');
      const toggleExpandButton = document.getElementById('toggleExpandButton');

      if (isExpanded) {
        toggleExpandButton.style.display = "block";
      } else if (calledList.scrollHeight > (calledContainer.clientHeight - rowHeight)) {
        toggleExpandButton.style.display = "block";
      } else {
        toggleExpandButton.style.display = "none";
      }
    }

    // Custom message box function (replaces alert/confirm)
    function showCustomMessageBox(message, type = 'info', callback = null) {
        const existingModal = document.getElementById('customMessageBox');
        if (existingModal) existingModal.remove(); // Remove any existing message box

        const modal = document.createElement('div');
        modal.id = 'customMessageBox';
        modal.classList.add('reset-modal-overlay'); // Reuse the overlay style
        modal.innerHTML = `
            <div class="reset-modal-content">
                <h2 class="text-xl font-bold text-gray-900 mb-4">${type === 'error' ? 'Error' : 'Notification'}</h2>
                <p class="text-gray-700 mb-6">${message}</p>
                <button id="messageBoxOkButton" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition duration-200 ease-in-out">
                    OK
                </button>
            </div>
        `;
        document.body.appendChild(modal);

        document.getElementById('messageBoxOkButton').addEventListener('click', () => {
            modal.remove();
            if (callback) callback();
        });

        // Hide if clicking outside
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.remove();
                if (callback) callback();
            }
        });
    }

    function setupBingoCallerListeners() {
      const callButton = document.getElementById('callButton');
      const resetButton = document.getElementById('resetButton'); // This is the original reset button
      const gameModeSelector = document.getElementById('gameMode');
      const currentElementDisplay = document.getElementById('currentElementDisplay');
      const calledList = document.getElementById('calledList');
      const calledContainer = document.getElementById('calledContainer');
      const toggleExpandButton = document.getElementById('toggleExpandButton');
      const modalOverlay = document.getElementById('elementModal'); // Element details modal
      const modalName = document.getElementById('modalName');
      const modalAtomic = document.getElementById('modalAtomic');
      const modalMass = document.getElementById('modalMass');
      const modalCharges = document.getElementById('modalCharges');
      const modalState = document.getElementById('modalState');
      const modalClose = document.getElementById('modalClose');
      const bohrDiagramDiv = document.getElementById('bohrDiagram');

      // New: Reset Confirmation Modal elements
      const resetConfirmationModal = document.getElementById('resetConfirmationModal');
      const confirmResetButton = document.getElementById('confirmResetButton');
      const cancelResetButton = document.getElementById('cancelResetButton');

      gameModeSelector.addEventListener('change', initBingoCaller);

      callButton.addEventListener('click', function() {
        // 1. Remove red outline from any previously recently-called cell
        document.querySelectorAll('td.recently-called').forEach(td => td.classList.remove('recently-called'));

        // 2. Process the element that was 'current' from the *previous* call
        if (currentElement !== null) {
          const prevCurrentCell = document.getElementById('elem-' + currentElement);
          prevCurrentCell.classList.remove('current'); // Remove 'current' status
          prevCurrentCell.classList.add('called'); // Mark it as 'called' (turns white)
          prevCurrentCell.classList.add('recently-called'); // Add red outline to this element

          // Add to the called list
          const li = document.createElement('li');
          li.textContent = elementDetails[currentElement].name; // Use elementDetails for consistent naming
          calledList.insertBefore(li, calledList.firstChild);
          checkOverflow();
        }

        // 3. Check if there are elements left to call for the *next* element
        if (remainingElements.length === 0) {
          currentElementDisplay.textContent = "All elements have been called!";
          // If game ends, ensure no 'recently-called' outline remains
          document.querySelectorAll('td.recently-called').forEach(td => td.classList.remove('recently-called'));
          return;
        }

        // 4. Select the next element to be the 'current' one
        const randomIndex = Math.floor(Math.random() * remainingElements.length);
        const nextAtomic = remainingElements.splice(randomIndex, 1)[0];
        currentElement = nextAtomic; // Update currentElement to the newly selected one

        const newCurrentCell = document.getElementById('elem-' + nextAtomic);
        currentElementDisplay.textContent = elementDetails[nextAtomic].name; // Display the new current element
        // Do NOT add 'current' class
      });

      toggleExpandButton.addEventListener('click', function() {
        if (isExpanded) {
          calledContainer.style.height = desiredCollapseHeight + "px";
          toggleExpandButton.textContent = "Expand";
          isExpanded = false;
        } else {
          calledContainer.style.height = "auto";
          toggleExpandButton.textContent = "Collapse";
          isExpanded = true;
        }
      });

      // Modified: Reset button now shows confirmation modal
      resetButton.addEventListener('click', function() {
        resetConfirmationModal.classList.remove('hidden'); // Show the reset confirmation modal
      });

      // New: Event listener for "Confirm Reset" button
      confirmResetButton.addEventListener('click', () => {
          initBingoCaller(); // Perform the actual reset
          resetConfirmationModal.classList.add('hidden'); // Hide the modal
          //showCustomMessageBox('The game has been reset!'); // Show a custom success message
      });

      // New: Event listener for "Cancel Reset" button
      cancelResetButton.addEventListener('click', () => {
          resetConfirmationModal.classList.add('hidden'); // Hide the modal
      });

      // New: Hide reset confirmation modal if clicking outside its content
      resetConfirmationModal.addEventListener('click', (event) => {
          if (event.target === resetConfirmationModal) {
              resetConfirmationModal.classList.add('hidden');
          }
      });


      // Modal functionality (for element details)
      function showElementDetailsModal(details) {
        modalName.textContent = details.name;
        modalAtomic.textContent = details.atomicNumber;
        modalMass.textContent = details.atomicMass;
        modalCharges.textContent = details.commonIonicCharges.length ? details.commonIonicCharges.join(", ") : "None";
        modalState.textContent = details.state;
        bohrDiagramDiv.innerHTML = createBohrDiagram(details.atomicNumber);
        modalOverlay.style.display = "flex";
      }

      function hideElementDetailsModal() { // Renamed to avoid conflict
        modalOverlay.style.display = "none";
      }

      // Attach event listeners to each periodic table cell
      document.querySelectorAll('td[id^="elem-"]').forEach(cell => {
        cell.addEventListener('click', function(e) {
          if (cell.classList.contains('empty') || cell.classList.contains('label')) return;
          const atomic = cell.getAttribute('data-atomic');
          // Use the centralized elementDetails object directly
          const details = elementDetails[atomic];
          if (details) {
            showElementDetailsModal(details);
          } else {
            console.error("Element details not found for atomic number:", atomic);
          }
          e.stopPropagation();
        });
      });

      modalClose.addEventListener('click', hideElementDetailsModal);
      modalOverlay.addEventListener('click', function(e) {
        if (e.target === modalOverlay) hideElementDetailsModal();
      });
    }


    // --- Card Generator Script ---
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function combination(n, r) {
      if (r < 0 || r > n) return 0;
      if (r === 0 || r === n) return 1;
      if (r > n / 2) r = n - r;
      let num = 1,
        den = 1;
      for (let i = 0; i < r; i++) {
        num *= (n - i);
        den *= (i + 1);
      }
      return Math.round(num / den);
    }

    function pWinSingle(k, T) {
      const C = (n, r) => combination(n, r);
      let p4_line = (k >= 4 && T >= 4) ? C(k, 4) / C(T, 4) : 0;
      let p5_line = (k >= 5 && T >= 5) ? C(k, 5) / C(T, 5) : 0;
      p4_line = Math.min(1, p4_line);
      p5_line = Math.min(1, p5_line);
      let p_not_win_4 = Math.pow(1 - p4_line, 4);
      let p_not_win_5 = Math.pow(1 - p5_line, 8);
      let p_win = 1 - (p_not_win_4 * p_not_win_5);
      return Math.max(0, Math.min(1, p_win));
    }

    function updateInfoBox(elementsList) {
      const numCards = parseInt(document.getElementById("numCards").value) || 1;
      const T = elementsList.length;
      const infoBox = document.getElementById("infoBox");

      if (T < 24) {
        infoBox.innerHTML = `<strong>Warning:</strong> Element set has only ${T} items. Need at least 24. Probabilities cannot be calculated.`;
        return;
      }

      let k_med = 4;
      let p_total_med = 0;
      while (k_med <= T && p_total_med < 0.5) {
        let p_single = pWinSingle(k_med, T);
        p_total_med = 1 - Math.pow(1 - p_single, numCards);
        if (p_total_med >= 0.5) break;
        k_med++;
      }
      if (k_med > T) k_med = T;

      let k_1percent = 4;
      let p_total_1percent = 0;
      while (k_1percent <= T && p_total_1percent < 0.01) {
        let p_single = pWinSingle(k_1percent, T);
        p_total_1percent = 1 - Math.pow(1 - p_single, numCards);
        if (p_total_1percent >= 0.01) break;
        k_1percent++;
      }
      if (k_1percent > T) k_1percent = T;

      let k_single_50 = 4;
      let p_single_50 = 0;
      while (k_single_50 <= T && p_single_50 < 0.5) {
        p_single_50 = pWinSingle(k_single_50, T);
        if (p_single_50 >= 0.5) break;
        k_single_50++;
      }
      if (k_single_50 > T) k_single_50 = T;

      let expectedWinners = numCards * pWinSingle(k_med, T);
      const infoText = `<strong>Probabilities (Approx.)</strong><br>Using <strong>${T}</strong> elements for <strong>${numCards}</strong> player(s):<br> ~<strong>${k_med}</strong> calls needed for  50% chance of <i>any</i> winner.<br> ~<strong>${k_1percent}</strong> calls needed for  1% chance of <i>any</i> winner.<br> ~<strong>${k_single_50}</strong> calls needed for  50% chance for a <i>single</i> card to win.<br> At the <strong>${k_med}</strong> call mark (~50% overall), expect ~<strong>${expectedWinners.toFixed(2)}</strong> winner(s).`;
      infoBox.innerHTML = infoText;
    }

    function generateBingoCard(elementsList, shortSetLabel) {
      if (elementsList.length < 24) {
        console.error("Not enough elements to generate a card.");
        return '<div class="bingo-card" style="border: 2px dashed red; padding: 10px; text-align: center;">Error: Not enough elements.</div>';
      }
      let availableElements = shuffle(elementsList.slice());
      let cardElements = availableElements.slice(0, 24);
      let cardHTML = `<div class="card-header">ELEMENT BINGO (${shortSetLabel})</div>`;
      cardHTML += '<div class="card-grid">';
      let elementIndex = 0;
      for (let row = 0; row < 5; row++) {
        for (let col = 0; col < 5; col++) {
          if (row === 2 && col === 2) {
            cardHTML += '<div class="bingo-cell free">FREE</div>';
          } else {
            if (elementIndex < cardElements.length) {
              cardHTML += `<div class="bingo-cell">${cardElements[elementIndex++]}</div>`;
            } else {
              cardHTML += '<div class="bingo-cell">?</div>'; // Fallback, though should not happen with 24 elements
            }
          }
        }
      }
      cardHTML += '</div>';
      return `<div class="bingo-card">${cardHTML}</div>`;
    }

    function generatePreview() {
      const numCards = parseInt(document.getElementById("numCards").value) || 1;
      const elementSet = document.getElementById("elementSet").value;
      const fontChoice = document.getElementById("fontChoice").value;
      let elementsList, shortSetLabel;

      // Get elements based on selected set from the centralized source
      elementsList = getSymbolsForSet(elementSet);

      if (elementSet === "top70") {
        shortSetLabel = "'70";
      } else if (elementSet === "fiftySix") {
        shortSetLabel = "'56";
      } else { // 'all'
        shortSetLabel = "'118";
      }

      const container = document.getElementById("cardsContainer");
      container.innerHTML = "";
      container.style.fontFamily = fontChoice;

      if (elementsList.length >= 24) {
        for (let i = 0; i < numCards; i++) {
          container.innerHTML += generateBingoCard(elementsList, shortSetLabel);
        }
        updateInfoBox(elementsList);
      } else {
        container.innerHTML = '<p style="color: red; padding: 20px;">Error: Not enough elements selected for a bingo card (minimum 24 required).</p>';
        document.getElementById("infoBox").innerHTML = `<strong>Error:</strong> Element set has only ${elementsList.length} items. Minimum 24 required.`;
      }
    }

    // Generate a new window for PDF printing using the old (working) print layout.
    function generatePDFWindow() {
      const numCards = parseInt(document.getElementById("numCards").value) || 1;
      const cardsPerPage = parseInt(document.getElementById("cardsPerPage").value);
      const elementSet = document.getElementById("elementSet").value;
      const paperSize = document.getElementById("paperSize").value;
      const chosenFont = document.getElementById("fontChoice").value;
      let elementsList, shortSetLabel;

      // Get elements based on selected set from the centralized source
      elementsList = getSymbolsForSet(elementSet);

      if (elementSet === "top70") {
        shortSetLabel = "'70";
      } else if (elementSet === "fiftySix") {
        shortSetLabel = "'56";
      } else { // 'all'
        shortSetLabel = "'118";
      }

      if (elementsList.length < 24) {
        // Using a custom message box instead of alert()
        showCustomMessageBox("Error: Cannot generate print view because there are less than 24 elements.", 'error');
        return;
      }

      // Determine page dimensions (in mm) then convert to pixels (approx. 3.78px per mm)
      let pageWidthMM, pageHeightMM;
      if (paperSize === "A4") {
        pageWidthMM = 210; pageHeightMM = 297;
      } else {
        pageWidthMM = 216; pageHeightMM = 279;
      }
      const mmToPx = 3.78;
      const pageWidthPx = pageWidthMM * mmToPx;
      const pageHeightPx = pageHeightMM * mmToPx;
      const gapPx = 10;

      // Calculate maximum card size based on layout.
      let cardSizePx;
      if (cardsPerPage === 1) {
        cardSizePx = 0.9 * Math.min(pageWidthPx, pageHeightPx);
      } else if (cardsPerPage === 2) {
        cardSizePx = 0.9 * Math.min(pageWidthPx, (pageHeightPx - gapPx) / 2);
      } else { // cardsPerPage === 4
        cardSizePx = 0.9 * Math.min((pageWidthPx - gapPx) / 2, (pageHeightPx - gapPx) / 2);
      }
      cardSizePx = Math.floor(cardSizePx);

      // Create an array of bingo card HTML strings (using your generateBingoCard function).
      const cards = [];
      for (let i = 0; i < numCards; i++) {
        cards.push(generateBingoCard(elementsList, shortSetLabel));
      }

      // Group cards into pages.
      let pagesHTML = "";
      for (let i = 0; i < cards.length; i += cardsPerPage) {
        const pageCards = cards.slice(i, i + cardsPerPage);
        let pageContent = "";
        pageCards.forEach(cardHTML => {
          pageContent += `<div class="pdf-card" style="width:${cardSizePx}px; height:${cardSizePx}px; margin: auto;">${cardHTML}</div>`;
        });
        let pageWrapperStyle = "";
        if (cardsPerPage === 1) {
          pageWrapperStyle = `display: flex; align-items: center; justify-content: center;`;
        } else if (cardsPerPage === 2) {
          pageWrapperStyle = `display: grid; grid-template-columns: 1fr; align-items: center; justify-items: center; gap: ${gapPx}px;`;
        } else { // cardsPerPage === 4
          pageWrapperStyle = `display: grid; grid-template-columns: 1fr 1fr; align-items: center; justify-items: center; gap: ${gapPx}px;`;
        }
        pagesHTML += `
          <div class="pdf-page" style="width:${pageWidthPx}px; height:${pageHeightPx}px; ${pageWrapperStyle} margin: auto; page-break-after: always;">
            ${pageContent}
          </div>
        `;
      }

      // Build complete HTML for the PDF window using the old (proven) printing layout.
      const pdfWindowHTML = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="utf-8">
          <title>Bingo Cards PDF</title>
          <style>
            body { margin: 0; padding: 0; font-family: ${chosenFont}; }
            .pdf-page { box-sizing: border-box; }
            .pdf-card { width: 100%; height: 100%; }
            .bingo-card {
              border: 2px solid #000;
              display: flex;
              flex-direction: column;
              border-radius: 0.375rem; /* Rounded edges */
              overflow: hidden;      /* Ensure inner content clips to rounded corners */
            }
            .card-header {
              background-color: #f2f2f2;
              text-align: center;
              font-weight: bold;
              padding: 5px 0;
              border-bottom: 2px solid #000;
            }
            .card-grid {
              width: 100%;
              height: 100%;
              display: grid;
              grid-template-columns: repeat(5, calc(100% / 5));
              grid-template-rows: repeat(5, calc(100% / 5));
            }
            .bingo-cell {
              border: 1px solid #000;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 24px;
              font-weight: bold;
              aspect-ratio: 1/1;
            }
            .free { background-color: #eee; !important;}
          </style>
        </head>
        <body>
          ${pagesHTML}
          <script>
            window.onload = function() {
              setTimeout(function() {
                window.print();
                window.onafterprint = function() { window.close(); };
              }, 500);
            };
          <\/script>
        </body>
        </html>
      `;

      const printWindow = window.open("", "_blank");
      if (printWindow) {
        printWindow.document.open();
        printWindow.document.write(pdfWindowHTML);
        printWindow.document.close();
      } else {
        // Using a custom message box instead of alert()
        showCustomMessageBox("Could not open print window. Please check your browser's pop-up blocker settings.", 'error');
      }
    }

    function setupCardGeneratorListeners() {
      // Get all relevant input elements
      const numCardsInput = document.getElementById("numCards");
      const cardsPerPageSelect = document.getElementById("cardsPerPage");
      const elementSetSelect = document.getElementById("elementSet");
      const paperSizeSelect = document.getElementById("paperSize");
      const fontChoiceSelect = document.getElementById("fontChoice");
      const randomizeButton = document.getElementById("generate"); // Renamed to Randomize

      // Add event listeners for automatic updates
      numCardsInput.addEventListener("input", generatePreview); // Use 'input' for real-time updates as user types
      cardsPerPageSelect.addEventListener("change", generatePreview);
      elementSetSelect.addEventListener("change", generatePreview);
      paperSizeSelect.addEventListener("change", generatePreview);
      fontChoiceSelect.addEventListener("change", generatePreview);

      // Keep the "Randomize" button for manual regeneration
      randomizeButton.addEventListener("click", generatePreview);
      document.getElementById("pdfBtn").addEventListener("click", generatePDFWindow);
    }

    // --- Initialize on page load ---
    document.addEventListener('DOMContentLoaded', function() {
      // Set up menu listeners
      menuButtonCaller.addEventListener('click', toggleMenu);
      // Add event listener for the new menu button on the generator page
      menuButtonGenerator.addEventListener('click', toggleMenu);

      menuClose.addEventListener('click', hideMenu);
      // Removed the generic menuOverlay click to hideModal as it conflicts with the new reset modal
      // menuOverlay.addEventListener('click', function(e) {
      //   if (e.target === menuOverlay) hideModal();
      // });
      showCallerBtn.addEventListener('click', () => showPage('bingoCaller'));
      showGeneratorBtn.addEventListener('click', () => showPage('cardGenerator'));

      // Initialize the Bingo Caller page and its listeners
      initBingoCaller();
      setupBingoCallerListeners();

      // Show the default page (Bingo Caller)
      showPage('bingoCaller');
    });
  </script>
</body>
</html>
